# Constant workload for the web shop FaaS benchmark.
config:
  target: ' '
  phases:
    #Constant load for 15min (900s), 3 flows per second
    - duration: 900
      arrivalRate: 3
  processor: '{{ $processEnvironment.PROCESSOR_DIR }}/logger.js'

  payload:
    path: 'users.csv'
    fields:
      - 'userName'
      - 'name'
      - 'password'
  variables:
    product:
      - 'QWERTY'
      - 'EASYSTOOL'
      - 'REFLECTXXX'
scenarios:
  # Just call frontend
  - flow:
      - get:
          url: '{{ frontend }}/'
          beforeRequest: 'beforeRequest'
          afterResponse: 'afterResponse'
    name: 'just frontend'
    weight: 5
  # Call frontend and browse two products
  - flow:
      - get:
          url: '{{ frontend }}/'
          beforeRequest: 'beforeRequest'
          afterResponse: 'afterResponse'
      - get:
          url: '{{ frontend }}/product/{{product}}'
          beforeRequest: 'beforeRequest'
          afterResponse: 'afterResponse'
      - get:
          url: '{{ frontend }}/product/{{product}}'
          beforeRequest: 'beforeRequest'
          afterResponse: 'afterResponse'
    name: 'frontend with browsing around'
    weight: 4
  # frontend, register (if needed), login, and browsing two products
  - flow:
      - get:
          url: '{{ frontend }}/'
          beforeRequest: 'beforeRequest'
          afterResponse: 'afterResponse'
      # Check if user needs registration
      - function: 'setNeedsRegistration'
      # Register only if not already registered
      - post:
          url: '{{ frontend }}/register'
          name: 'register'
          ifTrue: 'needsRegistration'
          followRedirect: false
          form:
            userName: '{{ userName }}'
            password: '{{ password }}'
          beforeRequest: 'beforeRegister'
          afterResponse: 'afterRegister'
      - post:
          url: '{{ frontend }}/setUser'
          name: 'login'
          followRedirect: false
          form:
            userName: '{{ userName }}'
            password: '{{ password }}'
          beforeRequest: 'beforeRequest'
          afterResponse: 'afterResponse'
      - get:
          url: '{{ frontend }}/'
          beforeRequest: 'beforeRequest'
          afterResponse: 'afterResponse'
      - get:
          url: '{{ frontend }}/product/{{product}}'
          beforeRequest: 'beforeRequest'
          afterResponse: 'afterResponse'
      - get:
          url: '{{ frontend }}/product/{{product}}'
          beforeRequest: 'beforeRequest'
          afterResponse: 'afterResponse'

    weight: 1
    name: 'frontend with logging in, not buying anything'
  # frontend, register (if needed), login, browse two products, buy one
  - flow:
      - get:
          url: '{{ frontend }}/'
          beforeRequest: 'beforeRequest'
          afterResponse: 'afterResponse'
      # Check if user needs registration
      - function: 'setNeedsRegistration'
      # Register only if not already registered
      - post:
          url: '{{ frontend }}/register'
          name: 'register'
          ifTrue: 'needsRegistration'
          followRedirect: false
          form:
            userName: '{{ userName }}'
            password: '{{ password }}'
          beforeRequest: 'beforeRegister'
          afterResponse: 'afterRegister'
      - post:
          url: '{{ frontend }}/setUser'
          name: 'login'
          followRedirect: false
          form:
            userName: '{{ userName }}'
            password: '{{ password }}'
          beforeRequest: 'beforeRequest'
          afterResponse: 'afterResponse'
      - get:
          url: '{{ frontend }}/'
          beforeRequest: 'beforeRequest'
          afterResponse: 'afterResponse'
      - get:
          url: '{{ frontend }}/product/{{product}}'
          beforeRequest: 'beforeRequest'
          afterResponse: 'afterResponse'
      - get:
          url: '{{ frontend }}/product/{{product}}'
          beforeRequest: 'beforeRequest'
          afterResponse: 'afterResponse'
      - post:
          url: '{{ frontend }}/addCartItem'
          followRedirect: false
          form:
            productId: '{{ product }}'
            quantity: 1
          beforeRequest: 'beforeRequest'
          afterResponse: 'afterResponse'
      - get:
          url: '{{ frontend }}/product/{{product}}'
          beforeRequest: 'beforeRequest'
          afterResponse: 'afterResponse'
      - get:
          url: '{{ frontend }}/cart'
          beforeRequest: 'beforeRequest'
          afterResponse: 'afterResponse'
      - post:
          url: '{{ frontend }}/checkout'
          followRedirect: false
          form:
            email: 'blubb@blubbmail.com'
            street_address: 'awesome street'
            zip_code: '12362'
            city: 'nope city'
            state: 'NY'
            country: 'Germany GmbH'
            credit_card_number: '4432-8015-6152-0454'
            credit_card_expiration_month: '1'
            credit_card_expiration_year: '2021'
            credit_card_cvv: '123'
          beforeRequest: 'beforeRequest'
          afterResponse: 'afterResponse'
    weight: 1
    name: 'frontend with logging in, buying one thing'